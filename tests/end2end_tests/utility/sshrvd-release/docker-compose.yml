version: '3'

services:
  image-runtime-release:
    build:
      context: ../../image/
      dockerfile: ./Dockerfile
      target: runtime-release
    image: atsigncompany/sshnp-e2e-runtime:release
    deploy:
      mode: replicated
      replicas: 0
  container-sshrvd:
    image: atsigncompany/sshnp-e2e-runtime:release
    container_name: sshrvd
    volumes:
      - ../../contexts/sshrvd/keys/:/atsign/.atsign/keys/ # mount keys
      - ../../contexts/sshrvd/entrypoint.sh:/atsign/entrypoint.sh # mount entrypoint.sh
    network_mode: host
    depends_on:
      - image-runtime-release

